{# src/site/_includes/components/user/common/header/wiki-card.njk #}

{% set cardTitle = title or page.fileSlug or 'Nota sin t√≠tulo' %}

{# MODIFICACI√ìN CLAVE: Comprobaci√≥n de existencia doble antes de llamar #}
{% set noteData = null %}

{% if noteFinder and noteFinder.getFrontmatter %}
    {% set noteData = noteFinder.getFrontmatter(page.fileSlug) %}
{% endif %}

{% set displayedProperties = [] %}

<aside class="wiki-card-container" style="/* ... estilos ... */">
    
    <div class="wiki-card-header">
        <h3>DEBUG: RESULTADO FINAL</h3>
    </div>
    
    <div class="wiki-card-content">
        <p>T√≠tulo: **{{ cardTitle }}**</p>
        
        <hr>
        
        {% if noteFinder and noteFinder.getFrontmatter %}
            {# Ejecuci√≥n solo si la herramienta existe #}
            {% if noteData and noteData.estado %}
                <p style="color: green; font-weight: bold;">üéâ ¬°√âXITO! FRONTMATTER ENCONTRADO.</p>
                {# ... el resto de tu l√≥gica de visualizaci√≥n ... #}
                
            {% else %}
                <p style="color: red; font-weight: bold;">‚ùå FALLO EN LA B√öSQUEDA: Propiedades no encontradas.</p>
            {% endif %}
        {% else %}
            {# Se ejecuta si la p√°gina no es una nota (e.g., Index, 404) #}
            <p style="color: orange; font-weight: bold;">‚ö†Ô∏è Herramienta `noteFinder` no disponible en este contexto (P√°gina de √≠ndice/404).</p>
        {% endif %}
    </div>
</aside>
